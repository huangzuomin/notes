<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åª’ä½“äººAIé©±åŠ¨åŠ›æŒ‡æ•° (MADI) æ·±åº¦è¯Šæ–­</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #003366;
            --accent: #D4AF37;
            --text: #333;
            --bg: #F5F7FA;
            --white: #fff;
            --radius: 12px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: "PingFang SC", sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
        
        .container { max-width: 800px; margin: 0 auto; min-height: 100vh; background: var(--white); box-shadow: 0 0 30px rgba(0,0,0,0.05); position: relative; }
        .screen { padding: 40px 24px; display: none; opacity: 0; transition: opacity 0.4s ease; }
        .screen.active { display: block; opacity: 1; }

        /* é€šç”¨ç»„ä»¶ */
        h1, h2, h3 { color: var(--primary); font-weight: 700; }
        .btn { display: block; width: 100%; padding: 16px; border-radius: 8px; font-size: 18px; font-weight: 600; text-align: center; cursor: pointer; border: none; transition: 0.3s; margin-top: 20px; }
        .btn-primary { background: var(--accent); color: var(--white); box-shadow: 0 4px 10px rgba(212, 175, 55, 0.3); }
        .btn-primary:hover { transform: scale(1.02); background: #c5a028; }
        
        /* æ¬¢è¿é¡µ */
        .hero { text-align: center; padding: 40px 0; }
        .role-select { width: 100%; padding: 15px; border: 2px solid #eee; border-radius: 8px; font-size: 16px; margin: 20px 0; outline: none; }
        .role-select:focus { border-color: var(--primary); }

        /* ç­”é¢˜åŒº */
        .progress-bar { height: 6px; background: #eee; margin-bottom: 30px; border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }
        
        .question-card { margin-bottom: 20px; }
        .q-tag { background: #E6F0FA; color: var(--primary); padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; margin-bottom: 10px; display: inline-block; }
        .q-text { font-size: 18px; font-weight: 600; margin-bottom: 20px; }

        /* Likert é‡è¡¨æ ·å¼ */
        .likert-options { display: flex; justify-content: space-between; gap: 5px; margin: 20px 0; }
        .likert-btn { flex: 1; padding: 15px 5px; border: 1px solid #ddd; border-radius: 8px; background: #fff; cursor: pointer; font-size: 14px; text-align: center; transition: 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .likert-btn:hover { border-color: var(--primary); background: #f0f4f8; }
        .likert-btn.selected { background: var(--primary); color: white; border-color: var(--primary); }
        .likert-val { font-size: 18px; font-weight: bold; margin-bottom: 4px; }

        /* SJT é€‰é¡¹æ ·å¼ */
        .sjt-option { padding: 16px; border: 1px solid #eee; border-radius: 8px; margin-bottom: 12px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; }
        .sjt-option:hover { border-color: var(--primary); background: #f9f9f9; }
        .sjt-option.selected { border: 2px solid var(--accent); background: #FFFDF5; }
        .circle { width: 20px; height: 20px; border: 2px solid #ccc; border-radius: 50%; margin-right: 12px; flex-shrink: 0; }
        .sjt-option.selected .circle { background: var(--accent); border-color: var(--accent); }

        /* PT è¯„åˆ†æ ·å¼ */
        .pt-area textarea { width: 100%; height: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; font-family: inherit; }
        .rubric-box { background: #f8f9fa; padding: 15px; border-radius: 8px; font-size: 14px; color: #555; margin-bottom: 15px; border-left: 4px solid var(--accent); }
        .pt-slider-container { margin-top: 20px; }
        .pt-slider { width: 100%; margin: 10px 0; }
        .pt-score-display { text-align: center; font-weight: bold; color: var(--primary); }

        /* ç»“æœé¡µ */
        .report-header { background: var(--primary); color: white; padding: 30px; border-radius: var(--radius); text-align: center; margin-bottom: 30px; }
        .total-score { font-size: 48px; font-weight: 800; color: var(--accent); margin: 10px 0; }
        .level-badge { background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px; font-size: 14px; }
        
        .card { background: white; border: 1px solid #eee; border-radius: var(--radius); padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
        .card h3 { border-left: 4px solid var(--accent); padding-left: 10px; margin-bottom: 15px; font-size: 18px; }
        
        .action-list li { margin-bottom: 10px; padding-left: 20px; position: relative; list-style: none; }
        .action-list li::before { content: "â€¢"; color: var(--accent); font-weight: bold; position: absolute; left: 0; }
        
        .warning-banner { background: #FFF0F0; color: #D8000C; padding: 10px; border-radius: 8px; margin-bottom: 20px; font-size: 13px; display: none; border: 1px solid #FFBABA; }

    </style>
</head>
<body>

<div class="container">

    <!-- Screen 1: è§’è‰²é€‰æ‹©ä¸æ¬¢è¿ -->
    <div id="screen-welcome" class="screen active">
        <div class="hero">
            <h1>MADI åª’ä½“äººAIé©±åŠ¨åŠ›æŒ‡æ•°</h1>
            <h2 style="font-size: 16px; font-weight:normal; margin-top:10px; color:#666;">æ·±åº¦è¯Šæ–­ç‰ˆ v1.0</h2>
            <p style="margin: 30px 0; color: #555;">
                åŸºäºâ€œé©±åŠ¨åŠ›â€æ¨¡å‹ï¼Œä»å·¥å…·ã€æŒ‡ä»¤ã€ååŒã€åˆ›æ–°ã€ä¼¦ç†äº”ä¸ªç»´åº¦ï¼Œ<br>
                ä¸ºæ‚¨æä¾›ç²¾å‡†çš„èƒ½åŠ›ç”»åƒä¸å‡æ¡£å»ºè®®ã€‚
            </p>
            
            <div style="text-align: left; margin-bottom: 5px; font-weight: bold; color: var(--primary);">è¯·é€‰æ‹©æ‚¨çš„å²—ä½è§’è‰²ï¼š</div>
            <select id="role-selector" class="role-select">
                <option value="reporter">è®°è€…/ä¸€çº¿é‡‡ç¼– (ä¾§é‡ååŒä¸åˆ›æ–°)</option>
                <option value="video">è§†é¢‘/éŸ³é¢‘åˆ¶ä½œ (ä¾§é‡å·¥å…·ä¸åˆ›æ–°)</option>
                <option value="editor">ç¼–è¾‘/å®¡æ ¸ (ä¾§é‡ä¼¦ç†ä¸ååŒ)</option>
                <option value="data">æ•°æ®è®°è€… (ä¾§é‡å·¥å…·ä¸æŒ‡ä»¤)</option>
                <option value="manager">ç®¡ç†è€…/å†³ç­–å±‚ (ä¾§é‡ååŒä¸ç®¡ç†)</option>
            </select>

            <div style="background: #f0f8ff; padding: 10px; border-radius: 8px; font-size: 12px; color: #666; text-align: left;">
                â± é¢„è®¡è€—æ—¶ï¼š12-15åˆ†é’Ÿ (æé€Ÿç‰ˆ)<br>
                ğŸ›¡ éšç§è¯´æ˜ï¼šæœ¬æµ‹è¯•ä¸ºçº¯å‰ç«¯è¿è¡Œï¼Œä¸ä¸Šä¼ æ‚¨çš„ä»»ä½•æ•°æ®ã€‚
            </div>

            <button class="btn btn-primary" onclick="startAssessment()">å¼€å§‹æ·±åº¦è¯Šæ–­</button>
        </div>
    </div>

    <!-- Screen 2: æµ‹è¯„è¿‡ç¨‹ -->
    <div id="screen-quiz" class="screen">
        <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
        
        <div id="question-container">
            <!-- åŠ¨æ€æ³¨å…¥é¢˜ç›® -->
        </div>

        <div style="margin-top: 30px; text-align: center;">
            <button id="next-btn" class="btn btn-primary" style="display:none;" onclick="nextQuestion()">ä¸‹ä¸€é¢˜</button>
        </div>
    </div>

    <!-- Screen 3: æ­£åœ¨ç”Ÿæˆ -->
    <div id="screen-loading" class="screen" style="text-align: center; padding-top: 100px;">
        <div style="font-size: 40px; animation: spin 1s infinite linear; display:inline-block; color:var(--accent);">âš™ï¸</div>
        <h3>æ­£åœ¨è®¡ç®—å¤šç»´æƒé‡...</h3>
        <p>æ­£åœ¨ç”Ÿæˆæ‚¨çš„ä¸ªæ€§åŒ–è¡ŒåŠ¨æ¸…å•</p>
    </div>

    <!-- Screen 4: æŠ¥å‘Šé¡µ -->
    <div id="screen-report" class="screen">
        <div id="warning-banner" class="warning-banner">
            âš ï¸ æ£€æµ‹åˆ°é«˜é£é™©æ“ä½œå€¾å‘ï¼šè¯·ç«‹å³åœæ­¢åœ¨å…¬ç½‘ç¯å¢ƒå¤„ç†æœªè„±æ•çš„å†…éƒ¨æ•æ„Ÿæ•°æ®ã€‚
        </div>

        <div class="report-header">
            <div class="level-badge" id="result-role">å²—ä½ï¼šè®°è€…</div>
            <div>MADI ç»¼åˆé©±åŠ¨åŠ›</div>
            <div class="total-score" id="result-score">0</div>
            <div style="font-size: 24px; font-weight: bold;" id="result-level">LV0</div>
            <p id="result-desc" style="margin-top: 10px; opacity: 0.9;">...</p>
        </div>

        <div class="card">
            <h3>äº”ç»´èƒ½åŠ›é›·è¾¾</h3>
            <div style="height: 300px;">
                <canvas id="radarChart"></canvas>
            </div>
            <div id="strength-weakness" style="margin-top: 20px; font-size: 14px; color: #555;"></div>
        </div>

        <div class="card">
            <h3>ğŸš€ å‡æ¡£è¡ŒåŠ¨æ¸…å• (Next 7 Days)</h3>
            <ul class="action-list" id="action-list-7">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </ul>
        </div>

        <div class="card">
            <h3>ğŸ“… è¿›é˜¶è§„åˆ’ (Next 30 Days)</h3>
            <ul class="action-list" id="action-list-30">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </ul>
        </div>

        <button class="btn btn-primary" onclick="alert('æŒ‰Ctrl+Pæˆ–ä½¿ç”¨æµè§ˆå™¨èœå•å³å¯ä¿å­˜ä¸ºPDF')">ä¿å­˜/æ‰“å°æŠ¥å‘Š</button>
        <button class="btn" style="background:transparent; color:#666; margin-top:10px;" onclick="location.reload()">é‡æ–°æµ‹è¯•</button>
    </div>

</div>

<script>
/* ================= é…ç½®ä¸æ•°æ® ================= */

// è§’è‰²æƒé‡é…ç½® (Total = 100)
const ROLE_WEIGHTS = {
    reporter: { tools: 18, prompt: 22, collab: 28, innovate: 20, ethics: 12 },
    video:    { tools: 22, prompt: 18, collab: 25, innovate: 25, ethics: 10 },
    data:     { tools: 20, prompt: 20, collab: 20, innovate: 20, ethics: 20 },
    editor:   { tools: 15, prompt: 20, collab: 25, innovate: 15, ethics: 25 },
    manager:  { tools: 15, prompt: 20, collab: 30, innovate: 20, ethics: 15 }
};

// é¢˜åº“ (æ··åˆäº† Likert, SJT, PT)
// æ³¨æ„ï¼šè¿™é‡Œå±•ç¤ºçš„æ˜¯â€œæé€Ÿç‰ˆâ€ç²¾é€‰é¢˜ç›®ï¼Œé€»è¾‘ä¸Šæ”¯æŒæ— é™æ‰©å±•
const QUESTIONS = [
    // --- A. å·¥å…·åº”ç”¨ ---
    {
        id: "A1", dimension: "tools", type: "likert",
        text: "æˆ‘å¸¸æ€åŒ–åŒæ—¶ä½¿ç”¨æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘/è§†é¢‘ä¸‰ç±»AIå·¥å…·æ¥å®Œæˆæ•´æ¡å†…å®¹é“¾ã€‚",
        reverse: false
    },
    {
        id: "A_SJT1", dimension: "tools", type: "sjt",
        text: "åœºæ™¯ï¼šä¸´æ—¶éœ€è¦åœ¨ä¸¤å°æ—¶å†…åšå‡ºâ€œå°é£ç™»é™†å¿«è®¯â€çš„å›¾æ–‡+30ç§’ç«–å±è§†é¢‘ã€‚ä»¥ä¸‹å“ªç§åšæ³•æœ€å¥½ï¼Ÿ",
        options: [
            { text: "A. åªç”¨ç†Ÿæ‚‰çš„å¯¹è¯å¼AIå†™ç¨¿ï¼Œè§†é¢‘æ”¹æœŸã€‚", score: 1 },
            { text: "B. åŒæ—¶è°ƒç”¨æ°”è±¡æ•°æ®+å›¾åƒç”Ÿæˆ+TTSï¼Œæ‹¼å‡ºæ¨¡æ¿åŒ–æˆç‰‡ã€‚", score: 5 },
            { text: "C. å¤–åŒ…å‰ªè¾‘ï¼Œè‡ªå·±å†™æ–‡æ¡ˆã€‚", score: 3 }
        ]
    },
    {
        id: "A_PT", dimension: "tools", type: "pt",
        text: "å®æ“è‡ªè¯„ï¼šè¯·åœ¨è„‘æµ·ä¸­æ„å»ºä¸€ä¸ªâ€œAIå·¥å…·æ ˆâ†’å·¥ä½œæµâ€çš„è¿æ¥ã€‚è¿™ä¸ªå·¥ä½œæµæ˜¯å¦åŒ…å«è‡ªåŠ¨è§¦å‘æœºåˆ¶ï¼Ÿ",
        rubric: "0åˆ†=æ— ï¼›3åˆ†=æ¸…æ™°çš„ä¸‰æ­¥è¿æ¥ï¼›5åˆ†=åŒ…å«APIè¿æ¥æˆ–è‡ªåŠ¨åŒ–è§¦å‘ä¸”æœ‰å¤±è´¥å›é€€æœºåˆ¶ã€‚"
    },

    // --- B. æŒ‡ä»¤å·¥ç¨‹ ---
    {
        id: "B1", dimension: "prompt", type: "likert",
        text: "æˆ‘åœ¨é‡è¦ä»»åŠ¡å‰ä¼šå†™â€œè§’è‰²+ç›®æ ‡+çº¦æŸ+è¾“å‡ºæ ¼å¼â€çš„ç»“æ„åŒ–æŒ‡ä»¤ã€‚",
        reverse: false
    },
    {
        id: "B6", dimension: "prompt", type: "likert",
        text: "å½“AIé¦–ç­”ä¸ç†æƒ³æ—¶ï¼Œæˆ‘é€šå¸¸ç›´æ¥æ”¾å¼ƒæˆ–æ¢ä¸€ä¸ªå·¥å…·ï¼Œè€Œä¸æ˜¯ä¼˜åŒ–æé—®ã€‚",
        reverse: true // åå‘é¢˜
    },
    {
        id: "B_SJT2", dimension: "prompt", type: "sjt",
        text: "åœºæ™¯ï¼šAIæ“…è‡ªè™šæ„äº†é‡‡è®¿å¯¹è±¡çš„è¯­å½•ã€‚ä½ é¦–å…ˆåº”åšä»€ä¹ˆï¼Ÿ",
        options: [
            { text: "A. ä¸¥å‰æ–¥è´£å®ƒâ€œåˆ«èƒ¡ç¼–â€ã€‚", score: 1 },
            { text: "B. è¿½é—®ç”Ÿæˆä¾æ®å¹¶è¦æ±‚åˆ—å‡ºæ¥æºé“¾æ¥ï¼Œå†æä¾›çœŸå®ç´ æä½œä¸ºå‚è€ƒã€‚", score: 5 },
            { text: "C. ç›´æ¥è‡ªå·±æ”¹å†™äº†äº‹ã€‚", score: 3 }
        ]
    },

    // --- C. äººæœºååŒ ---
    {
        id: "C1", dimension: "collab", type: "likert",
        text: "æˆ‘å·²æŠŠAIçº³å…¥â€œé€‰é¢˜â†’é‡‡é›†â†’æ•´ç†â†’å†™ä½œâ†’å®¡æ ¸â€ä¸­è‡³å°‘3ä¸ªå…³é”®ç¯èŠ‚ã€‚",
        reverse: false
    },
    {
        id: "C_PT", dimension: "collab", type: "pt",
        text: "å®æ“è‡ªè¯„ï¼šå›é¡¾ä½ æœ€è¿‘çš„ä¸€æ¬¡å›¢é˜Ÿåˆä½œï¼Œæ˜¯å¦å»ºç«‹äº†æ˜ç¡®çš„â€œäººæœºååŒæ³³é“å›¾â€ï¼ˆè°åšã€AIåšä»€ä¹ˆã€è°éªŒæ”¶ï¼‰ï¼Ÿ",
        rubric: "0åˆ†=æ— ï¼›3åˆ†=æœ‰ç®€å•çš„å£å¤´åˆ†å·¥ï¼›5åˆ†=æœ‰ä¹¦é¢çš„æµç¨‹å›¾ã€éªŒæ”¶æ ‡å‡†å’Œé£é™©æ§åˆ¶ç‚¹ã€‚"
    },

    // --- D. å†…å®¹åˆ›æ–° ---
    {
        id: "D1", dimension: "innovate", type: "likert",
        text: "æˆ‘ä½¿ç”¨AIä¸»è¦æ˜¯ä¸ºäº†æ¢ç´¢æ–°å†…å®¹å½¢æ€ï¼ˆå¦‚æ•°æ®æ–°é—»ã€äº’åŠ¨å™äº‹ï¼‰ï¼Œè€Œä¸ä»…æ˜¯ææ•ˆã€‚",
        reverse: false
    },
    {
        id: "D_SJT1", dimension: "innovate", type: "sjt",
        text: "åœºæ™¯ï¼šä½ è¦åšâ€œæ²¿æµ·æ¸”æ‘å£è¿°å²â€äº’åŠ¨ä¸“é¢˜ï¼Œä¼˜å…ˆæ–¹æ¡ˆï¼Ÿ",
        options: [
            { text: "A. ä¼ ç»Ÿé•¿æ–‡é…å›¾ã€‚", score: 3 },
            { text: "B. éŸ³é¢‘è®¿è°ˆâ†’ASRè½¬å†™â†’ä¸»é¢˜åˆ†æâ†’ç”Ÿæˆæ—¶é—´è½´å¯è§†åŒ–â†’çŸ­è§†é¢‘äºŒåˆ›ã€‚", score: 5 },
            { text: "C. å®Œå…¨ç”¨AIç”Ÿæˆè™šæ„æ•…äº‹ã€‚", score: 1 }
        ]
    },

    // --- E. ä¼¦ç†ä¸å®¡æŸ¥ ---
    {
        id: "E6", dimension: "ethics", type: "likert",
        text: "ä¸ºäº†èµ¶è¿›åº¦ï¼Œæˆ‘ä¼šå°†æœªè„±æ•çš„å†…éƒ¨ä¼šè®®è®°å½•ç›´æ¥ä¸Šä¼ åˆ°å…¬ç½‘æ¨¡å‹å¤„ç†ã€‚",
        reverse: true // é«˜å±åå‘é¢˜
    },
    {
        id: "E_SJT1", dimension: "ethics", type: "sjt",
        text: "åœºæ™¯ï¼šAIç”Ÿæˆäº†ä¸€å¼ æ¶‰åŠå…¬å…±äº‹ä»¶çš„åˆæˆå›¾ã€‚æœ€ä½³å¤„ç†æ–¹å¼ï¼Ÿ",
        options: [
            { text: "A. æ¸…æ™°æ ‡æ³¨â€œAIåˆæˆâ€è¯´æ˜ï¼Œå¹¶ä¿ç•™åŸå§‹ç´ æå¯è¿½æº¯ã€‚", score: 5 },
            { text: "B. æ‰“ä¸ªæ°´å°å³å¯ã€‚", score: 3 },
            { text: "C. ä¸æ ‡æ³¨ï¼Œçœ‹ç€åƒçœŸçš„å°±è¡Œã€‚", score: 1 }
        ]
    }
];

/* ================= çŠ¶æ€ç®¡ç† ================= */
let state = {
    role: 'reporter',
    currentQIndex: 0,
    answers: {}, // { qId: score }
    startTime: 0,
    isSpeeding: false
};

/* ================= æ ¸å¿ƒé€»è¾‘ ================= */

function startAssessment() {
    state.role = document.getElementById('role-selector').value;
    state.startTime = Date.now();
    switchScreen('screen-welcome', 'screen-quiz');
    renderQuestion();
}

function renderQuestion() {
    const q = QUESTIONS[state.currentQIndex];
    const container = document.getElementById('question-container');
    const progress = ((state.currentQIndex) / QUESTIONS.length) * 100;
    document.getElementById('progress-fill').style.width = `${progress}%`;
    
    // éšè—ä¸‹ä¸€é¢˜æŒ‰é’®ï¼Œç›´åˆ°ä½œç­”
    document.getElementById('next-btn').style.display = 'none';

    let html = `
        <div>
            <span class="q-tag">${getDimName(q.dimension)}</span>
            <div class="q-text">${state.currentQIndex + 1}. ${q.text}</div>
    `;

    // æ ¹æ®é¢˜å‹æ¸²æŸ“
    if (q.type === 'likert') {
        html += `<div class="likert-options">`;
        const options = [
            { val: 1, label: "éå¸¸ä¸åŒæ„" },
            { val: 2, label: "ä¸åŒæ„" },
            { val: 3, label: "ä¸ç¡®å®š" },
            { val: 4, label: "åŒæ„" },
            { val: 5, label: "éå¸¸åŒæ„" }
        ];
        options.forEach(opt => {
            html += `
                <div class="likert-btn" onclick="selectLikert(${opt.val}, '${q.id}', this)">
                    <div class="likert-val">${opt.val}</div>
                    <div style="font-size:12px; color:#666;">${opt.label}</div>
                </div>`;
        });
        html += `</div>`;
    } 
    else if (q.type === 'sjt') {
        html += `<div class="sjt-container">`;
        q.options.forEach((opt, idx) => {
            html += `
                <div class="sjt-option" onclick="selectSJT(${opt.score}, '${q.id}', this)">
                    <div class="circle"></div>
                    <div>${opt.text}</div>
                </div>`;
        });
        html += `</div>`;
    }
    else if (q.type === 'pt') {
        html += `
            <div class="pt-area">
                <div class="rubric-box">ğŸ’¡ è¯„åˆ†é‡è§„ï¼š${q.rubric}</div>
                <textarea placeholder="åœ¨æ­¤ç®€è¦æè¿°æ‚¨çš„æ€è·¯ï¼ˆé€‰å¡«ï¼Œä»…ç”¨äºè¾…åŠ©æ‚¨è‡ªæˆ‘æ‰“åˆ†ï¼‰..."></textarea>
                <div class="pt-slider-container">
                    <label>è¯·æ ¹æ®é‡è§„ä¸ºè‡ªå·±æ‰“åˆ† (0-5)ï¼š</label>
                    <input type="range" min="0" max="5" step="1" value="0" class="pt-slider" oninput="updatePTSlider(this, '${q.id}')">
                    <div class="pt-score-display">0 åˆ†</div>
                </div>
            </div>
        `;
        // PTé¢˜é»˜è®¤ç»™0åˆ†ï¼Œæ˜¾ç¤ºä¸‹ä¸€æ­¥æŒ‰é’®
        setTimeout(() => {
            state.answers[q.id] = 0;
            document.getElementById('next-btn').style.display = 'block';
        }, 100);
    }

    html += `</div>`;
    container.innerHTML = html;
}

// äº¤äº’å¤„ç†
function selectLikert(val, qId, el) {
    document.querySelectorAll('.likert-btn').forEach(b => b.classList.remove('selected'));
    el.classList.add('selected');
    
    // åå‘è®¡åˆ†é€»è¾‘ï¼šå¦‚æœæ˜¯åå‘é¢˜ï¼Œåˆ™ 6 - val
    const q = QUESTIONS.find(i => i.id === qId);
    const score = q.reverse ? (6 - val) : val;
    
    state.answers[qId] = score;
    autoNext();
}

function selectSJT(score, qId, el) {
    document.querySelectorAll('.sjt-option').forEach(b => b.classList.remove('selected'));
    el.classList.add('selected');
    state.answers[qId] = score;
    autoNext();
}

function updatePTSlider(el, qId) {
    const val = parseInt(el.value);
    el.nextElementSibling.innerText = val + " åˆ†";
    state.answers[qId] = val;
    document.getElementById('next-btn').style.display = 'block';
}

function autoNext() {
    // å»¶è¿Ÿè·³è½¬ï¼Œç»™ç”¨æˆ·çœ‹æ¸…é€‰ä¸­çŠ¶æ€
    setTimeout(() => {
        nextQuestion();
    }, 400);
}

function nextQuestion() {
    if (state.currentQIndex < QUESTIONS.length - 1) {
        state.currentQIndex++;
        renderQuestion();
    } else {
        finishQuiz();
    }
}

function finishQuiz() {
    // æ£€æŸ¥ä½œç­”æ—¶é—´
    const duration = (Date.now() - state.startTime) / 1000;
    // å‡è®¾æé€Ÿç‰ˆå¦‚æœå°äº30ç§’åšå®Œï¼Œåˆ¤å®šä¸ºè¿‡å¿«
    if (duration < 30) state.isSpeeding = true;

    switchScreen('screen-quiz', 'screen-loading');
    setTimeout(calculateResults, 1500);
}

/* ================= ç»“ç®—ä¸æŠ¥å‘Š ================= */

function calculateResults() {
    const scores = { tools: [], prompt: [], collab: [], innovate: [], ethics: [] };
    let rawScores = {};

    // 1. æ”¶é›†åˆ†æ•°å¹¶å½’ç±»
    QUESTIONS.forEach(q => {
        const score = state.answers[q.id] || 0;
        scores[q.dimension].push(score);
        
        // é£é™©æ£€æµ‹
        if (q.id === 'E6' && score <= 2) { // E6æ˜¯åå‘é¢˜ï¼Œé€‰1æˆ–2(éå¸¸ä¸åŒæ„)å¾—åˆ†ä¸º5/4åˆ†(å®‰å…¨)ï¼›é€‰4/5(åŒæ„)å¾—åˆ†ä¸º2/1åˆ†(å±é™©)
            // é€»è¾‘ä¿®æ­£ï¼šåå‘é¢˜ E6 "æˆ‘ä¼šä¸Šä¼ å†…éƒ¨èµ„æ–™"ã€‚
            // ç”¨æˆ·é€‰"5-éå¸¸åŒæ„" -> è®¡åˆ† 6-5=1åˆ† (é«˜é£é™©)ã€‚
            if (score <= 2) document.getElementById('warning-banner').style.display = 'block';
        }
    });

    // 2. è®¡ç®—å„ç»´åº¦ç™¾åˆ†åˆ¶å¾—åˆ† (å¹³å‡åˆ†/5 * 100)
    let dimResults = {};
    for (let dim in scores) {
        const arr = scores[dim];
        const sum = arr.reduce((a,b)=>a+b, 0);
        // å½’ä¸€åŒ–ï¼š(æ€»åˆ† / (é¢˜æ•°*5)) * 100
        dimResults[dim] = Math.round((sum / (arr.length * 5)) * 100);
    }

    // 3. æ ¹æ®è§’è‰²æƒé‡è®¡ç®—æ€»åˆ†
    const weights = ROLE_WEIGHTS[state.role];
    let madiScore = 0;
    for (let dim in dimResults) {
        madiScore += dimResults[dim] * (weights[dim] / 100);
    }
    madiScore = Math.round(madiScore);

    // 4. æ¡£ä½åˆ¤å®š
    let level = "LV0";
    let levelDesc = "";
    if (madiScore < 20) { level = "LV0 - å¼•æ“æœªå¯"; levelDesc = "æ‚¨å°šæœªå»ºç«‹AIå·¥ä½œæµï¼Œä»å¤„äºçº¯äººå·¥ç”Ÿäº§é˜¶æ®µã€‚"; }
    else if (madiScore < 35) { level = "LV1 - æ€ é€Ÿé¢„çƒ­"; levelDesc = "æ‚¨å·²å¼€å§‹å°è¯•ï¼Œä½†å°šæœªå½¢æˆç¨³å®šçš„ç”Ÿäº§åŠ›å¢ç›Šã€‚"; }
    else if (madiScore < 50) { level = "LV2 - ä¸€æ¡£èµ·æ­¥"; levelDesc = "AIå·²æˆä¸ºæ‚¨çš„è¾…åŠ©å·¥å…·ï¼Œåˆ†æ‹…äº†éƒ¨åˆ†åŸºç¡€å·¥ä½œã€‚"; }
    else if (madiScore < 70) { level = "LV3 - å·¡èˆªé©¾é©¶"; levelDesc = "æ‚¨èƒ½ç†Ÿç»ƒé©¾é©­AIï¼Œæ˜¯å›¢é˜Ÿä¸­å¯é çš„å…ˆè¿›ç”Ÿäº§åŠ›ã€‚"; }
    else if (madiScore < 85) { level = "LV4 - è¿åŠ¨æ¨¡å¼"; levelDesc = "æ‚¨æ­£åœ¨é‡å¡‘å·¥ä½œæµï¼Œæ‹¥æœ‰æé«˜çš„åˆ›æ–°ä¸æ‰§è¡Œæ•ˆç‡ã€‚"; }
    else { level = "LV5 - æ™ºèƒ½é¢†èˆª"; levelDesc = "æ‚¨ç«™åœ¨è¡Œä¸šé¡¶ç«¯ï¼Œæ­£åœ¨å®šä¹‰äººæœºååŒçš„æœªæ¥èŒƒå¼ã€‚"; }

    if(state.isSpeeding) levelDesc += " (æ³¨ï¼šä½œç­”é€Ÿåº¦è¿‡å¿«ï¼Œç»“æœå¯èƒ½ä¸å‡†ç¡®)";

    // 5. æ¸²æŸ“æŠ¥å‘Š
    document.getElementById('result-score').innerText = madiScore;
    document.getElementById('result-level').innerText = level;
    document.getElementById('result-desc').innerText = levelDesc;
    document.getElementById('result-role').innerText = `å²—ä½ï¼š${getRoleName(state.role)}`;

    renderRadar(dimResults);
    generateActionPlan(dimResults);
    
    switchScreen('screen-loading', 'screen-report');
}

function renderRadar(data) {
    const ctx = document.getElementById('radarChart').getContext('2d');
    new Chart(ctx, {
        type: 'radar',
        data: {
            labels: ['å·¥å…·åº”ç”¨', 'æŒ‡ä»¤å·¥ç¨‹', 'äººæœºååŒ', 'å†…å®¹åˆ›æ–°', 'ä¼¦ç†å®¡æŸ¥'],
            datasets: [{
                label: 'èƒ½åŠ›ç»´åº¦å¾—åˆ† (0-100)',
                data: [data.tools, data.prompt, data.collab, data.innovate, data.ethics],
                backgroundColor: 'rgba(212, 175, 55, 0.2)',
                borderColor: '#D4AF37',
                pointBackgroundColor: '#003366'
            }]
        },
        options: {
            scales: { r: { min: 0, max: 100, ticks: { stepSize: 20 } } },
            plugins: { legend: { display: false } }
        }
    });

    // å¼ºå¼±é¡¹é€»è¾‘
    const entries = Object.entries(data).sort((a,b) => b[1] - a[1]);
    const top = entries[0];
    const bottom = entries[entries.length-1];
    document.getElementById('strength-weakness').innerHTML = 
        `ğŸŒŸ æ‚¨çš„æœ€å¼ºé¡¹æ˜¯ <b>${getDimName(top[0])}</b> (${top[1]}åˆ†)ï¼Œ` +
        `å»ºè®®é‡ç‚¹æå‡ <b>${getDimName(bottom[0])}</b> (${bottom[1]}åˆ†)ã€‚`;
}

function generateActionPlan(data) {
    const list7 = document.getElementById('action-list-7');
    const list30 = document.getElementById('action-list-30');
    let actions7 = [];
    let actions30 = [];

    // æ ¹æ®çŸ­æ¿ç”Ÿæˆå»ºè®®
    if (data.prompt < 60) {
        actions7.push("å»ºç«‹æ‚¨çš„ç¬¬ä¸€ä¸ªâ€œç»“æ„åŒ–æç¤ºè¯â€æ¨¡æ¿ï¼ˆåŒ…å«è§’è‰²ã€ä»»åŠ¡ã€èƒŒæ™¯ã€çº¦æŸï¼‰ã€‚");
        actions30.push("åˆ›å»ºä¸€ä¸ªä¸ªäººçš„ Prompt åº“ï¼Œæ”¶é›†è‡³å°‘ 10 ä¸ªé«˜é¢‘åœºæ™¯çš„ä¼˜è´¨æŒ‡ä»¤ã€‚");
    }
    if (data.collab < 60) {
        actions7.push("å°è¯•åœ¨ä¸€æ¬¡ä»»åŠ¡ä¸­ï¼Œæ˜ç¡®åˆ’åˆ†â€œäººåšåˆ¤æ–­ã€AIåšæ‰§è¡Œâ€çš„å…·ä½“è¾¹ç•Œã€‚");
        actions30.push("ç»˜åˆ¶æ‚¨å½“å‰æ ¸å¿ƒå·¥ä½œçš„â€œäººæœºååŒæ³³é“å›¾â€ï¼Œæ‰¾å‡ºå¯è‡ªåŠ¨åŒ–çš„å¡ç‚¹ã€‚");
    }
    if (data.ethics < 60) {
        actions7.push("æ£€æŸ¥æœ€è¿‘ç”Ÿæˆçš„å†…å®¹ï¼Œè¡¥å……æ¥æºé“¾æ¥æˆ–è¿›è¡ŒåŒæºéªŒè¯ã€‚");
        actions30.push("åˆ¶å®šä¸ªäººçš„â€œAIä½¿ç”¨çº¢çº¿æ¸…å•â€ï¼Œæ˜ç¡®å“ªäº›æ•°æ®ç»ä¸ä¸Šä¼ å…¬ç½‘ã€‚");
    }
    if (data.tools < 60) {
        actions7.push("å°è¯•ä¸€æ¬¾é™¤äº†å¯¹è¯æ¡†ä»¥å¤–çš„æ–°å½¢æ€AIå·¥å…·ï¼ˆå¦‚æ–‡æ¡£è§£ææˆ–PPTç”Ÿæˆï¼‰ã€‚");
    }
    
    // é€šç”¨å»ºè®®å¡«å……
    if (actions7.length < 2) actions7.push("å‘å›¢é˜Ÿä¸­çš„AIé«˜æ‰‹è¯·æ•™ä¸€ä¸ªææ•ˆå°æŠ€å·§ã€‚");
    if (actions30.length < 2) actions30.push("å¤ç›˜è¿‡å»ä¸€ä¸ªæœˆçš„å·¥ä½œï¼Œè®¡ç®—AIä¸ºæ‚¨èŠ‚çœçš„æ€»å·¥æ—¶ã€‚");

    list7.innerHTML = actions7.map(t => `<li>${t}</li>`).join('');
    list30.innerHTML = actions30.map(t => `<li>${t}</li>`).join('');
}

/* ================= å·¥å…·å‡½æ•° ================= */
function switchScreen(from, to) {
    document.getElementById(from).classList.remove('active');
    document.getElementById(to).classList.add('active');
    window.scrollTo(0,0);
}

function getDimName(key) {
    const map = { tools: "å·¥å…·åº”ç”¨", prompt: "æŒ‡ä»¤å·¥ç¨‹", collab: "äººæœºååŒ", innovate: "å†…å®¹åˆ›æ–°", ethics: "ä¼¦ç†å®¡æŸ¥" };
    return map[key];
}

function getRoleName(key) {
    const map = { reporter: "è®°è€…/é‡‡ç¼–", video: "è§†å¬åˆ¶ä½œ", data: "æ•°æ®è®°è€…", editor: "ç¼–è¾‘/å®¡æ ¸", manager: "ç®¡ç†è€…" };
    return map[key];
}

</script>
</body>
</html>
